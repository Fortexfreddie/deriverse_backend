{
  "openapi": "3.0.0",
  "info": {
    "title": "Deriverse Analytics API",
    "version": "1.0.0",
    "description": "Institutional-grade Solana trading analytics and AI-powered journaling."
  },
  "paths": {
    "/api/sync": {
      "post": {
        "summary": "Sync wallet trades from blockchain",
        "tags": ["Sync"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": { "walletAddress": { "type": "string" } },
                "required": ["walletAddress"]
              },
              "example": { "walletAddress": "FK4ugTURYRR2hbSDZr1Q1kqU4xX4UQP7o28cr3wUpG2q" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Sync successful",
            "content": {
              "application/json": {
                "example": { "success": true, "data": { "positionsUpdated": 2, "fillsProcessed": 5 } }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/ErrorResponse" },
          "500": { "$ref": "#/components/schemas/ErrorResponse" }
        }
      }
    },
    "/api/dashboard/{wallet}": {
      "get": {
        "summary": "Fetch live PnL dashboard",
        "tags": ["Dashboard"],
        "parameters": [
          { "name": "wallet", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": {
            "description": "Dashboard data fetched successfully",
            "content": {
              "application/json": {
                "example": {
                   "success": true,
                   "data": [
                       {
                           "positionId": "0-BUY-FK4ugTURYRR2hbSDZr1Q1kqU4xX4UQP7o28cr3wUpG2q",
                           "market": "SOL-PERP",
                           "side": "LONG",
                           "entry": 84.5867,
                           "current": 81.4,
                           "size": 1.6584,
                           "unrealized": -5.28,
                           "realized": 0,
                           "fees": 0.04
                       },
                       {
                           "positionId": "0-SELL-FK4ugTURYRR2hbSDZr1Q1kqU4xX4UQP7o28cr3wUpG2q",
                           "market": "SOL-PERP",
                           "side": "SHORT",
                           "entry": 84.87,
                           "current": 81.4,
                           "size": 2,
                           "unrealized": 6.94,
                           "realized": 0,
                           "fees": 0.05
                       }
                   ]
               }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/ErrorResponse" },
          "500": { "$ref": "#/components/schemas/ErrorResponse" }
        }
      }
    },
    "/api/trades/{wallet}": {
      "get": {
        "summary": "Fetch trade history",
        "tags": ["Trades"],
        "parameters": [
          { "name": "wallet", "in": "path", "required": true, "schema": { "type": "string" } },
          { "name": "market", "in": "query", "schema": { "type": "string" }, "required": false },
          { "name": "startDate", "in": "query", "schema": { "type": "string", "format": "date" }, "required": false },
          { "name": "endDate", "in": "query", "schema": { "type": "string", "format": "date" }, "required": false },
          { "name": "limit", "in": "query", "schema": { "type": "integer" }, "required": false },
          { "name": "offset", "in": "query", "schema": { "type": "integer" }, "required": false }
        ],
        "responses": {
          "200": {
            "description": "Trade history fetched successfully",
            "content": {
              "application/json": {
                "example": {
                   "success": true,
                   "data": [
                       {
                           "id": "59b936dc-b835-4a6a-bc62-950d429d0f38",
                           "signature": "8wQRPvjLybiYTxDognQ1fHs3WzodVTxkJvyBH1Tg687Ex5ypUb7yd9xAvkA8Ja1mgX3kaPSDbUUYWjbBB1pczEp",
                           "positionId": "0-SELL-FK4ugTURYRR2hbSDZr1Q1kqU4xX4UQP7o28cr3wUpG2q",
                           "price": 85.14,
                           "size": 1,
                           "fee": 0.047891,
                           "isEntry": true,
                           "orderType": "LIMIT",
                           "tradeType": "SPOT",
                           "notes": null,
                           "timestamp": "2026-02-09T16:02:43.000Z"
                       }
                   ],
                   "count": 4,
                   "total": 4,
                   "pagination": {
                       "limit": null,
                       "offset": null,
                       "hasMore": false
                   }
               }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/ErrorResponse" },
          "500": { "$ref": "#/components/schemas/ErrorResponse" }
        }
      }
    },
    "/api/analytics/{wallet}": {
      "get": {
        "summary": "Get comprehensive wallet analytics",
        "tags": ["Analytics"],
        "parameters": [
          { "name": "wallet", "in": "path", "required": true, "schema": { "type": "string" } },
          { "name": "market", "in": "query", "schema": { "type": "string" }, "required": false },
          { "name": "startDate", "in": "query", "schema": { "type": "string", "format": "date" }, "required": false },
          { "name": "endDate", "in": "query", "schema": { "type": "string", "format": "date" }, "required": false }
        ],
        "responses": {
          "200": {
            "description": "Full analytics payload",
            "content": {
              "application/json": {
                "example": {
                  "success": true,
                  "data": {
                    "totalPnl": { "realized": 0, "unrealized": 1.65, "total": 1.65 },
                    "winRate": 0,
                    "tradeCount": { "total": 2, "wins": 0, "losses": 0, "open": 2 },
                    "avgTradeDuration": 0,
                    "longShortRatio": 1,
                    "totalFees": 0.17,
                    "totalVolume": 310.02,
                    "feeComposition": { "spot": 0.12, "perp": 0.05, "total": 0.17 },
                    "sessionPerformance": {
                        "Asian": { "pnl": 0, "count": 0 },
                        "London": { "pnl": 0, "count": 0 },
                        "New York": { "pnl": 0, "count": 0 }
                    },
                    "marketPerformance": {
                        "SOL-PERP": { "pnl": 1.65, "winRate": 0, "tradeCount": 2, "volume": 310.02 }
                    },
                    "riskMetrics": {
                        "sharpeRatio": 1.45,
                        "sortinoRatio": 2.1,
                        "maxDrawdown": 15.4,
                        "profitFactor": 1.8,
                        "expectancy": 0.35,
                        "dailyVariance": 0.05,
                        "annualVolatility": 0.45
                    }
                  }
                }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/ErrorResponse" },
          "500": { "$ref": "#/components/schemas/ErrorResponse" }
        }
      }
    },
    "/api/analytics/{wallet}/historical-pnl": {
      "get": {
        "summary": "Get historical PnL chart data",
        "tags": ["Analytics"],
        "parameters": [
          { "name": "wallet", "in": "path", "required": true, "schema": { "type": "string" } },
          { "name": "startDate", "in": "query", "schema": { "type": "string", "format": "date" }, "required": false },
          { "name": "endDate", "in": "query", "schema": { "type": "string", "format": "date" }, "required": false }
        ],
        "responses": {
          "200": {
            "description": "Historical PnL data fetched successfully",
            "content": {
              "application/json": {
                "example": {
                    "success": true,
                    "data": [
                        { "date": "2026-02-09", "realizedPnl": 0, "unrealizedPnl": 12.50, "totalPnl": 12.50, "cumulativePnl": 12.50, "drawdown": 0 }
                    ]
                }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/ErrorResponse" },
          "500": { "$ref": "#/components/schemas/ErrorResponse" }
        }
      }
    },
    "/api/analytics/leaderboard": {
      "get": {
        "summary": "Get global leaderboard",
        "tags": ["Analytics"],
        "responses": {
          "200": {
            "description": "Leaderboard data fetched successfully",
            "content": {
              "application/json": {
                "example": {
                    "success": true,
                    "data": [
                        { "wallet": "FK4u...3wUp", "pnl": 1250.50 }
                    ]
                }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/ErrorResponse" },
          "500": { "$ref": "#/components/schemas/ErrorResponse" }
        }
      }
    },
    "/api/analytics/{wallet}/equity-curve": {
      "get": {
        "summary": "Get equity curve data",
        "tags": ["Analytics"],
        "parameters": [
          { "name": "wallet", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": {
            "description": "Equity curve data fetched successfully",
            "content": {
              "application/json": {
                "example": {
                    "success": true,
                    "data": [
                        { "timestamp": "2026-02-09T16:02:43.000Z", "equity": 10050.25, "change": 50.25, "market": "SOL-PERP" }
                    ]
                }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/ErrorResponse" },
          "500": { "$ref": "#/components/schemas/ErrorResponse" }
        }
      }
    },
    "/api/analytics/{wallet}/time-analysis": {
      "get": {
        "summary": "Get time-based performance metrics",
        "tags": ["Analytics"],
        "parameters": [
          { "name": "wallet", "in": "path", "required": true, "schema": { "type": "string" } },
          { "name": "startDate", "in": "query", "schema": { "type": "string", "format": "date" }, "required": false },
          { "name": "endDate", "in": "query", "schema": { "type": "string", "format": "date" }, "required": false }
        ],
         "responses": {
          "200": {
            "description": "Time analysis fetched successfully",
            "content": {
              "application/json": {
                  "example": {
                      "success": true,
                      "data": {
                          "hourly": [
                              { "hour": 0, "pnl": 1.5, "trades": 2, "winRate": 50, "volume": 100 }
                          ],
                          "daily": [
                              { "date": "2026-02-09", "day": "Monday", "pnl": 12.5, "trades": 5, "winRate": 60, "volume": 500 }
                          ]
                      }
                  }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/ErrorResponse" },
          "500": { "$ref": "#/components/schemas/ErrorResponse" }
        }
      }
    },
    "/api/analytics/{wallet}/composition": {
      "get": {
        "summary": "Get portfolio composition",
        "tags": ["Analytics"],
        "parameters": [
          {
            "in": "path",
            "name": "wallet",
            "schema": { "type": "string" },
            "required": true,
            "description": "Wallet address"
          }
        ],
        "responses": {
          "200": {
            "description": "Portfolio composition fetched successfully",
            "content": {
              "application/json": {
                "example": {
                    "success": true,
                    "data": [
                        { "market": "SOL-PERP", "value": 5000, "percentage": 50.0 },
                        { "market": "BTC-PERP", "value": 5000, "percentage": 50.0 }
                    ]
                }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/ErrorResponse" },
          "500": { "$ref": "#/components/schemas/ErrorResponse" }
        }
      }
    },
    "/api/analytics/{wallet}/behavior": {
      "get": {
        "summary": "Get behavioral metrics",
        "tags": ["Analytics"],
        "parameters": [
          {
            "in": "path",
            "name": "wallet",
            "schema": { "type": "string" },
            "required": true,
            "description": "Wallet address"
          }
        ],
        "responses": {
          "200": {
            "description": "Behavioral metrics fetched successfully",
            "content": {
              "application/json": {
                "example": {
                    "success": true,
                    "data": {
                        "expectancy": 150.5,
                        "winRate": 65.2,
                        "profitFactor": 2.1,
                        "riskRewardRatio": 1.5,
                        "revengeTradeCount": 2,
                        "streaks": { "current": 3, "maxWin": 5, "maxLoss": 2 },
                        "insights": ["Strong win rate of 65.2%."]
                    }
                }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/ErrorResponse" },
          "500": { "$ref": "#/components/schemas/ErrorResponse" }
        }
      }
    },
    "/api/journal/{positionId}": {
      "patch": {
        "summary": "Update journal entry for a position",
        "tags": ["Journal"],
        "parameters": [
          { "name": "positionId", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "notes": { "type": "string" },
                  "emotion": { "type": "string", "enum": ["Fearful", "Greedy", "Calm", "Anxious", "Neutral"] },
                  "rating": { "type": "integer", "minimum": 1, "maximum": 5 },
                  "hypotheticalExitPrice": { "type": "number" }
                }
              },
              "example": {
                "notes": "I entered this SOL trade because I saw a 15m breakout, but I panic sold...",
                "emotion": "Anxious",
                "rating": 2,
                "hypotheticalExitPrice": 125.50
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Journal updated successfully",
            "content": {
              "application/json": {
                "example": {
                   "success": true,
                   "data": {
                       "id": "0-SELL-FK4ugTURYRR2hbSDZr1Q1kqU4xX4UQP7o28cr3wUpG2q",
                       "notes": "I entered this SOL trade because I saw a 15m breakout...",
                       "rating": 2,
                       "emotion": "Anxious",
                       "aiReview": "Your journal entry describes actions (panic selling) that did not occur...",
                       "aiBias": "Denial",
                       "aiScore": 2,
                       "hypotheticalExitPrice": 125.5
                   },
                    "analysis": {
                        "aiAnalysis": {
                            "bias": "Denial",
                            "insight": "Your journal entry describes actions (panic selling) that did not occur based on execution data.",
                            "score": 2,
                            "advice": "Stick to your plan.",
                            "next_action": "Walk away for 5 mins."
                        },
                        "traderProfile": {
                            "profile": "The Dip Chaser",
                            "strength": "High Energy",
                            "weakness": "Impatience",
                            "nudge": "Wait for confirmation before entry."
                        },
                        "macroContext": {
                            "sentiment": "Neutral",
                            "macroContext": "Market is choppy. Avoid leverage."
                        },
                        "whatIfAnalysis": {
                            "opportunityCost": 45.20,
                            "opportunityCostNote": "You left money on the table."
                        }
                    }
                }
              }
            }
          },
          "400": { "$ref": "#/components/schemas/ErrorResponse" },
          "500": { "$ref": "#/components/schemas/ErrorResponse" }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean", "example": false },
          "error": { "type": "string" }
        }
      }
    }
  }
}